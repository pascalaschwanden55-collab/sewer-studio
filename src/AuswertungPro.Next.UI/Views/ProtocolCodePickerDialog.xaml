<Window x:Class="AuswertungPro.Next.UI.Views.ProtocolCodePickerDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Code auswaehlen"
        Width="1080"
        Height="700"
        WindowStartupLocation="CenterOwner">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.8*" />
            <ColumnDefinition Width="1.4*" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="0,0,10,10">
            <TextBlock Text="Suche:" VerticalAlignment="Center" Margin="0,0,6,0" />
            <TextBox Width="240" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />
            <TextBlock Text="Gruppe:" VerticalAlignment="Center" Margin="12,0,6,0" />
            <ComboBox Width="180" ItemsSource="{Binding GroupOptions}" SelectedItem="{Binding SelectedGroup}" />
        </StackPanel>

        <Grid Grid.Row="1" Grid.Column="0" Margin="0,0,10,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <TextBlock Text="Katalogstruktur" Margin="0,0,0,6" FontWeight="SemiBold" />
            <TreeView Grid.Row="1"
                      ItemsSource="{Binding CodeTree}"
                      SelectedItemChanged="TreeView_SelectedItemChanged">
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <TextBlock Text="{Binding Label}" />
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </Grid>

        <ScrollViewer Grid.Row="0" Grid.RowSpan="2" Grid.Column="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <TextBlock Text="Ausgewaehlter Code" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10" />

                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Code" Grid.Column="0" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" IsReadOnly="True" Text="{Binding SelectedCode.Code}" />
                </Grid>

                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Title" Grid.Column="0" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" IsReadOnly="True" Text="{Binding SelectedCode.Title}" />
                </Grid>

                <TextBlock Text="Description" />
                <TextBox Margin="0,2,0,10"
                         Height="72"
                         IsReadOnly="True"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"
                         Text="{Binding SelectedCode.Description}" />

                <TextBlock Text="Parameter" FontWeight="SemiBold" Margin="0,0,0,6" />
                <ItemsControl ItemsSource="{Binding ParameterValues}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,0,0,6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="170" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="90" />
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Name}" />
                                    <TextBlock Text=" *" Visibility="{Binding Required, Converter={StaticResource BoolToVis}}" />
                                </StackPanel>

                                <ComboBox Grid.Column="1"
                                          ItemsSource="{Binding AllowedValues}"
                                          SelectedItem="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          Visibility="{Binding IsEnum, Converter={StaticResource BoolToVis}}" />

                                <TextBox Grid.Column="1"
                                         Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Setter Property="Visibility" Value="Visible" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsEnum}" Value="True">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <TextBlock Grid.Column="2" Margin="8,0,0,0" VerticalAlignment="Center" Text="{Binding Unit}" />
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <TextBlock Text="Streckenschaden" FontWeight="SemiBold" Margin="0,8,0,4" />
                <TextBlock Text="{Binding RangeHint}" TextWrapping="Wrap" Foreground="DarkSlateGray" />

                <Separator Margin="0,8,0,8" />
                <TextBlock Text="Quantifizierung" FontWeight="SemiBold" Margin="0,0,0,6" />

                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="MeterStart" Grid.Column="0" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding MeterStartText, UpdateSourceTrigger=PropertyChanged}" />
                </Grid>

                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="MeterEnd" Grid.Column="0" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding MeterEndText, UpdateSourceTrigger=PropertyChanged}" />
                </Grid>

                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Severity" Grid.Column="0" VerticalAlignment="Center" />
                    <ComboBox Grid.Column="1" ItemsSource="{Binding SeverityOptions}" SelectedItem="{Binding Severity}" />
                </Grid>

                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Anzahl" Grid.Column="0" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding CountText, UpdateSourceTrigger=PropertyChanged}" />
                </Grid>

                <TextBlock Text="Notiz" />
                <TextBox Margin="0,2,0,8"
                         Height="80"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"
                         Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock Text="{Binding ValidationMessage}" Foreground="OrangeRed" TextWrapping="Wrap" />
            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button x:Name="ApplyButton" Content="Uebernehmen" Width="120" Margin="0,0,8,0" />
            <Button x:Name="CancelButton" Content="Abbrechen" Width="120" IsCancel="True" />
        </StackPanel>
    </Grid>
</Window>
