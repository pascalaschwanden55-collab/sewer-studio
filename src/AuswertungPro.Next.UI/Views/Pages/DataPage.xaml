<UserControl x:Class="AuswertungPro.Next.UI.Views.Pages.DataPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:AuswertungPro.Next.UI.Views.Pages">
    <UserControl.Resources>
        <local:CountToMarkConverter x:Key="Foto1Mark" MinCount="1"/>
        <local:CountToMarkConverter x:Key="Foto2Mark" MinCount="2"/>
        <local:StringNotEmptyToMarkConverter x:Key="FilmMark"/>
        <local:PhotoIndexToPathConverter x:Key="PhotoIndexPath"/>
        <local:PhotoIndexToVisibilityConverter x:Key="PhotoIndexVisible"/>
        <local:StringNotEmptyToVisibilityConverter x:Key="StringNotEmptyVisible"/>
        <local:AnyValueToVisibilityConverter x:Key="AnyValueVisible"/>
        <Style x:Key="AlignToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="26"/>
            <Setter Property="MinWidth" Value="30"/>
            <Setter Property="MinHeight" Value="26"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0,0,4,0"/>
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource NeonCyanBrush}"/>
                    <Setter Property="Background" Value="{StaticResource HeaderBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="SecondaryToggleButton" TargetType="ToggleButton">
            <Setter Property="MinHeight" Value="48"/>
            <Setter Property="MinWidth" Value="140"/>
            <Setter Property="Padding" Value="24,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style x:Key="CompactButton" TargetType="Button" BasedOn="{StaticResource SecondaryButton}">
            <Setter Property="MinHeight" Value="28"/>
            <Setter Property="MinWidth" Value="0"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        <Style x:Key="CompactToggleButton" TargetType="ToggleButton">
            <Setter Property="MinHeight" Value="28"/>
            <Setter Property="MinWidth" Value="0"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style x:Key="LinkButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Foreground" Value="{StaticResource NeonCyanBrush}"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <TextBlock Text="{TemplateBinding Content}"
                                   Foreground="{TemplateBinding Foreground}"
                                   TextDecorations="Underline"
                                   TextTrimming="CharacterEllipsis"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Foreground" Value="{StaticResource MutedBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Vertical" Margin="0,0,0,4">
            <Border Background="{StaticResource CardBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                    Padding="8" Margin="0,0,0,8" CornerRadius="6">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSaveStatusVisible}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <TextBlock Text="{Binding SaveStatus}" Foreground="{StaticResource TextBrush}" />
            </Border>

            <Border Background="{StaticResource CardBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                    Padding="8" Margin="0,0,0,8" CornerRadius="6">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsProjectReady}" Value="False">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <TextBlock Text="Bitte zuerst Projekt speichern (Datei anlegen), dann ist Bearbeitung moeglich."
                           Foreground="{StaticResource TextBrush}" />
            </Border>

            <Border Background="{StaticResource CardBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                    Padding="8" Margin="0,0,0,8" CornerRadius="6">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsLearningInfoVisible}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse Width="12" Height="12" Fill="{Binding LearningTrafficLightColor}" Margin="0,0,8,0" Stroke="{StaticResource NeonCyanBrush}" StrokeThickness="1"/>
                    <TextBlock Text="{Binding LearningTrafficLightText}" Foreground="{StaticResource TextBrush}" Margin="0,0,12,0" />
                    <TextBlock Text="{Binding LearningInfo}" Foreground="{StaticResource TextBrush}" />
                </StackPanel>
            </Border>

            <Border Background="{StaticResource CardBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                    Padding="4,3" CornerRadius="8">
                <StackPanel Orientation="Horizontal">
                    <Button Command="{Binding SaveCommand}"
                            Style="{StaticResource ToolbarButtonAccent}" Margin="0,0,2,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" FontSize="13" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Speichern" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding AddCommand}" IsEnabled="{Binding IsProjectReady}"
                            Style="{StaticResource ToolbarButton}" Margin="0,0,2,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE710;" FontFamily="Segoe MDL2 Assets" FontSize="13" Foreground="{StaticResource NeonGreenBrush}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Neu" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding RemoveCommand}" IsEnabled="{Binding IsProjectReady}"
                            Style="{StaticResource ToolbarButtonDanger}" Margin="0,0,2,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="13" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Löschen" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Border Width="1" Background="{StaticResource BorderBrush}" Margin="6,4"/>

                    <Button x:Name="KiToolsDropdown" Click="DropdownButton_Click"
                            Style="{StaticResource ToolbarButton}" Margin="0,0,2,0"
                            ToolTip="KI-Funktionen: Protokoll, Status, Videoanalyse">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE99A;" FontFamily="Segoe MDL2 Assets" FontSize="13" Foreground="{StaticResource InfoBrush}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="KI-Tools" VerticalAlignment="Center"/>
                            <TextBlock Text="&#xE70D;" FontFamily="Segoe MDL2 Assets" FontSize="9" VerticalAlignment="Center" Margin="4,0,0,0" Foreground="{StaticResource MutedBrush}"/>
                        </StackPanel>
                        <Button.ContextMenu>
                            <ContextMenu>
                                <MenuItem Click="ProtocolMenu_Click" InputGestureText="Doppelklick">
                                    <MenuItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="&#xE8FD;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                            <TextBlock Text="Protokoll (KI)" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </MenuItem.Header>
                                </MenuItem>
                                <MenuItem Command="{Binding ShowModelStatusCommand}">
                                    <MenuItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="&#xE946;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                            <TextBlock Text="KI-Status" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </MenuItem.Header>
                                </MenuItem>
                                <Separator/>
                                <MenuItem Click="VideoAiPipelineMenu_Click">
                                    <MenuItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="&#xE714;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                            <TextBlock Text="Videoanalyse (KI Pipeline)" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </MenuItem.Header>
                                </MenuItem>
                                <MenuItem Click="SanierungKiMenu_Click">
                                    <MenuItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="&#xE90F;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                            <TextBlock Text="KI Sanierung optimieren" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </MenuItem.Header>
                                </MenuItem>
                            </ContextMenu>
                        </Button.ContextMenu>
                    </Button>

                    <Button x:Name="MassnahmenDropdown" Click="DropdownButton_Click"
                            Style="{StaticResource ToolbarButton}" Margin="0,0,2,0"
                            ToolTip="Sanierungsmassnahmen und Kostenvorschlaege">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE90F;" FontFamily="Segoe MDL2 Assets" FontSize="13" Foreground="{StaticResource NeonPurpleBrush}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Massnahmen" VerticalAlignment="Center"/>
                            <TextBlock Text="&#xE70D;" FontFamily="Segoe MDL2 Assets" FontSize="9" VerticalAlignment="Center" Margin="4,0,0,0" Foreground="{StaticResource MutedBrush}"/>
                        </StackPanel>
                        <Button.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Empfohlene Massnahmen" Click="CostsMenu_Click"/>
                                <MenuItem Header="Wiederherstellen" Click="RestoreCostsMenu_Click"
                                          ToolTip="Kosten/Massnahmen aus costs.json wiederherstellen"/>
                                <MenuItem Header="Vorschlag aus Schadenscodes" Click="SuggestMeasuresMenu_Click"/>
                                <Separator/>
                                <MenuItem Header="Alle Massnahmen vorschlagen" Click="SuggestAllMeasuresMenu_Click"
                                          ToolTip="Sanierungsmassnahmen fuer alle Haltungen mit Sanierungsbedarf vorschlagen"/>
                            </ContextMenu>
                        </Button.ContextMenu>
                    </Button>

                    <Button x:Name="MediaSearchButton" Click="MediaSearchMenu_Click"
                            Style="{StaticResource ToolbarButton}" Margin="0,0,2,0"
                            ToolTip="Videos und PDFs automatisch suchen und mit Haltungen verlinken">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xED25;" FontFamily="Segoe MDL2 Assets" FontSize="13" Foreground="{StaticResource NeonGreenBrush}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Medien suchen" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Border Width="1" Background="{StaticResource BorderBrush}" Margin="6,4"/>

                    <Button x:Name="UndockButton" Click="UndockGrid_Click"
                            Style="{StaticResource ToolbarButton}" Margin="0,0,2,0"
                            ToolTip="DataGrid in separatem Fenster oeffnen (Multi-Monitor)">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE8A7;" FontFamily="Segoe MDL2 Assets" FontSize="13" Foreground="{StaticResource NeonCyanBrush}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Abdocken" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="AnsichtDropdown" Click="DropdownButton_Click"
                            Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Window}}"
                            Style="{StaticResource ToolbarButton}" Margin="0,0,2,0"
                            ToolTip="Zeilen, Spalten und Darstellung anpassen">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE7B3;" FontFamily="Segoe MDL2 Assets" FontSize="13" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Ansicht" VerticalAlignment="Center"/>
                            <TextBlock Text="&#xE70D;" FontFamily="Segoe MDL2 Assets" FontSize="9" VerticalAlignment="Center" Margin="4,0,0,0" Foreground="{StaticResource MutedBrush}"/>
                        </StackPanel>
                        <Button.ContextMenu>
                            <ContextMenu>
                                <MenuItem Command="{Binding MoveUpCommand}">
                                    <MenuItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="&#xE74A;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                            <TextBlock Text="Nach oben" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </MenuItem.Header>
                                </MenuItem>
                                <MenuItem Command="{Binding MoveDownCommand}">
                                    <MenuItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="&#xE74B;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                            <TextBlock Text="Nach unten" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </MenuItem.Header>
                                </MenuItem>
                                <Separator/>
                                <MenuItem Header="Spalten anordnen" IsCheckable="True" IsChecked="{Binding IsColumnReorderEnabled}"/>
                                <MenuItem x:Name="ClearColumnMenuItem" Header="Spalte leeren" IsCheckable="True"
                                          ToolTip="Aktivieren, dann auf Spaltentitel rechtsklicken"/>
                                <Separator/>
                                <MenuItem Header="Fokusmodus (F11)" IsCheckable="True"
                                          IsChecked="{Binding PlacementTarget.Tag.IsFocusMode, RelativeSource={RelativeSource AncestorType=ContextMenu}, Mode=TwoWay}"/>
                            </ContextMenu>
                        </Button.ContextMenu>
                    </Button>
                </StackPanel>
            </Border>

            <Border Background="{StaticResource CardBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                    Padding="4" Margin="0,4,0,0" CornerRadius="4">
                <StackPanel Orientation="Vertical">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Suche Schacht:" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox x:Name="SearchBox" Width="200" VerticalAlignment="Center"
                                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                 TextChanged="SearchBox_TextChanged"/>
                        <Button Margin="4,0,0,0" Style="{StaticResource IconButton}"
                                Command="{Binding ClearSearchCommand}" ToolTip="Suche zurücksetzen">
                            <TextBlock Text="&#xE711;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                        </Button>
                        <TextBlock Text="{Binding SearchResultInfo}" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center" Margin="12,0,0,0"/>
                        <TextBlock Text="Zeilenhoehe:" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center" Margin="16,0,8,0"/>
                        <Slider Width="100"
                                Minimum="24"
                                Maximum="240"
                                Value="{Binding GridMinRowHeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                SmallChange="2"
                                LargeChange="10"
                                IsSnapToTickEnabled="False"
                                VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding GridMinRowHeight, StringFormat={}{0:0}px}"
                                   Foreground="{StaticResource TextBrush}"
                                   VerticalAlignment="Center"
                                   Margin="4,0,0,0"
                                   MinWidth="32"/>

                        <TextBlock Text="Zoom:" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center" Margin="12,0,8,0"/>
                        <Slider Width="100"
                                Minimum="0.5"
                                Maximum="2.0"
                                Value="{Binding GridZoom, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                SmallChange="0.05"
                                LargeChange="0.1"
                                IsSnapToTickEnabled="False"
                                VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding GridZoom, StringFormat={}{0:0%}}"
                                   Foreground="{StaticResource TextBrush}"
                                   VerticalAlignment="Center"
                                   Margin="4,0,0,0"
                                   MinWidth="32"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,6,0,0">
                        <TextBlock Text="Ausrichtung:" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>

                        <StackPanel Orientation="Vertical">
                            <StackPanel Orientation="Horizontal">
                                <ToggleButton x:Name="AlignLeftButton" Style="{StaticResource AlignToggleButtonStyle}"
                                              ToolTip="Horizontal links" Click="AlignLeftButton_Click">
                                    <StackPanel Width="14" Height="12" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <Border Height="1.6" Width="12" HorizontalAlignment="Left" Margin="0,0,0,2" Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                        <Border Height="1.6" Width="9" HorizontalAlignment="Left" Margin="0,0,0,2" Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                        <Border Height="1.6" Width="11" HorizontalAlignment="Left" Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                    </StackPanel>
                                </ToggleButton>
                                <ToggleButton x:Name="AlignCenterButton" Style="{StaticResource AlignToggleButtonStyle}"
                                              ToolTip="Horizontal zentriert" Click="AlignCenterButton_Click">
                                    <StackPanel Width="14" Height="12" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <Border Height="1.6" Width="12" HorizontalAlignment="Center" Margin="0,0,0,2" Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                        <Border Height="1.6" Width="9" HorizontalAlignment="Center" Margin="0,0,0,2" Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                        <Border Height="1.6" Width="11" HorizontalAlignment="Center" Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                    </StackPanel>
                                </ToggleButton>
                                <ToggleButton x:Name="AlignRightButton" Style="{StaticResource AlignToggleButtonStyle}"
                                              ToolTip="Horizontal rechts" Click="AlignRightButton_Click">
                                    <StackPanel Width="14" Height="12" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <Border Height="1.6" Width="12" HorizontalAlignment="Right" Margin="0,0,0,2" Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                        <Border Height="1.6" Width="9" HorizontalAlignment="Right" Margin="0,0,0,2" Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                        <Border Height="1.6" Width="11" HorizontalAlignment="Right" Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                    </StackPanel>
                                </ToggleButton>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <ToggleButton x:Name="AlignTopButton" Style="{StaticResource AlignToggleButtonStyle}"
                                              ToolTip="Vertikal oben" Click="AlignTopButton_Click">
                                    <Grid Width="14" Height="12" HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <Border BorderThickness="1" CornerRadius="1"
                                                BorderBrush="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                        <Border Height="2" Width="8" VerticalAlignment="Top" Margin="0,2,0,0"
                                                Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                    </Grid>
                                </ToggleButton>
                                <ToggleButton x:Name="AlignMiddleButton" Style="{StaticResource AlignToggleButtonStyle}"
                                              ToolTip="Vertikal mitte" Click="AlignMiddleButton_Click">
                                    <Grid Width="14" Height="12" HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <Border BorderThickness="1" CornerRadius="1"
                                                BorderBrush="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                        <Border Height="2" Width="8" VerticalAlignment="Center"
                                                Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                    </Grid>
                                </ToggleButton>
                                <ToggleButton x:Name="AlignBottomButton" Style="{StaticResource AlignToggleButtonStyle}"
                                              ToolTip="Vertikal unten" Click="AlignBottomButton_Click">
                                    <Grid Width="14" Height="12" HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <Border BorderThickness="1" CornerRadius="1"
                                                BorderBrush="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                        <Border Height="2" Width="8" VerticalAlignment="Bottom" Margin="0,0,0,2"
                                                Background="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"/>
                                    </Grid>
                                </ToggleButton>
                            </StackPanel>
                        </StackPanel>

                        <TextBlock Text="(Zelle oder Spaltenkopf auswaehlen)"
                                   Foreground="{StaticResource MutedBrush}"
                                   VerticalAlignment="Center"
                                   Margin="10,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- GridHost: Container fuer DataGrid oder Platzhalter wenn abgedockt -->
        <Grid x:Name="GridHost" Grid.Row="1">
            <!-- Platzhalter (sichtbar wenn DataGrid abgedockt) -->
            <Border x:Name="UndockedPlaceholder" Visibility="Collapsed"
                    Background="{StaticResource CardBrush}" BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1" CornerRadius="8" Margin="8" VerticalAlignment="Center" HorizontalAlignment="Center">
                <StackPanel Orientation="Vertical" HorizontalAlignment="Center" Margin="40,30">
                    <TextBlock Text="&#xE8A7;" FontFamily="Segoe MDL2 Assets" FontSize="40"
                               Foreground="{StaticResource NeonCyanBrush}" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                    <TextBlock Text="DataGrid ist in separatem Fenster geoeffnet"
                               Foreground="{StaticResource TextBrush}" FontSize="16" FontWeight="SemiBold"
                               HorizontalAlignment="Center" Margin="0,0,0,8"/>
                    <TextBlock Text="Ziehen Sie das Fenster auf einen anderen Monitor fuer Multi-Monitor-Betrieb."
                               Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                               HorizontalAlignment="Center" Margin="0,0,0,16" TextWrapping="Wrap" TextAlignment="Center"/>
                    <Button x:Name="DockBackPlaceholderButton" Click="DockBackFromPlaceholder_Click"
                            Style="{StaticResource ToolbarButtonAccent}" HorizontalAlignment="Center">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE89F;" FontFamily="Segoe MDL2 Assets" FontSize="13" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Andocken" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Border>

        <DataGrid x:Name="Grid"
                      ItemsSource="{Binding Records}"
                      SelectedItem="{Binding Selected, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      IsReadOnly="{Binding IsDataGridReadOnly}"
                      CanUserResizeRows="True"
                      CanUserResizeColumns="True"
                      CanUserReorderColumns="{Binding IsColumnReorderEnabled}"
                      HeadersVisibility="All"
                      GridLinesVisibility="All"
                      VerticalGridLinesBrush="{StaticResource BorderBrush}"
                      HorizontalGridLinesBrush="{StaticResource BorderBrush}"
                      FrozenColumnCount="2"
                      RowHeaderWidth="24"
                      MinRowHeight="{Binding GridMinRowHeight}"
                      EnableRowVirtualization="True"
                      EnableColumnVirtualization="True"
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling"
                      VirtualizingPanel.ScrollUnit="Pixel"
                      ScrollViewer.CanContentScroll="True"
                      CanUserSortColumns="False"
                      CellEditEnding="Grid_CellEditEnding"
                      PreviewMouseLeftButtonDown="Grid_PreviewMouseLeftButtonDown"
                      PreviewMouseRightButtonDown="Grid_PreviewMouseRightButtonDown"
                      PreviewMouseMove="Grid_PreviewMouseMove"
                      AllowDrop="True"
                      Drop="Grid_Drop"
                      SelectedCellsChanged="Grid_SelectedCellsChanged"
                      CurrentCellChanged="Grid_CurrentCellChanged"
                      PreviewMouseWheel="Grid_PreviewMouseWheel"
                      PreviewMouseDoubleClick="Grid_PreviewMouseDoubleClick"
                      LoadingRow="Grid_LoadingRow">
                <DataGrid.LayoutTransform>
                    <ScaleTransform ScaleX="{Binding GridZoom}" ScaleY="{Binding GridZoom}"/>
                </DataGrid.LayoutTransform>
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Position nach oben" Click="MoveRecordUpMenu_Click" />
                        <MenuItem Header="Position nach unten" Click="MoveRecordDownMenu_Click" />
                        <Separator/>
                        <MenuItem Header="Beobachtungen..." Click="BeobachtungenMenu_Click" />
                        <Separator/>
                        <MenuItem Header="Play" Click="PlayMenu_Click" />
                        <MenuItem Header="Protokoll/KI anzeigen..." Click="ProtocolMenu_Click" />
                            <MenuItem Header="Videoanalyse (KI Pipeline)..." Click="VideoAiPipelineMenu_Click" />
                        <MenuItem Header="Video neu verlinken..." Click="RelinkMenu_Click" />
                        <MenuItem Header="Empfohlene Massnahmen..." Click="CostsMenu_Click" />
                        <MenuItem Header="Kosten/Massnahmen wiederherstellen..." Click="RestoreCostsMenu_Click" />
                        <MenuItem Header="Vorschlag aus Schadenscodes..." Click="SuggestMeasuresMenu_Click" />
                        <MenuItem Header="Alle Massnahmen vorschlagen..." Click="SuggestAllMeasuresMenu_Click" />
                        <MenuItem Header="KI Sanierung optimieren..." Click="SanierungKiMenu_Click" />
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
        </Grid>
    </Grid>
</UserControl>
